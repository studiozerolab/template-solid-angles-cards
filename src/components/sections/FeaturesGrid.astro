---
import AngleEdge from "../ui/AngleEdge.astro";

const {
  id,
  title,
  items = [],
  bg = "surface",       // surface | alt | primary-tint | accent-tint
  // prevBg = "surface",
  nextBg = 'alt',
  angleTop = false,
  angleBottom = true,
  dirTop ="left",   // left | right
  dirBottom = "right", // left | right
} = Astro.props;

const bgClass = `section-${bg}`;
const fillTop = `var(--color-${bg})`;
const nextColor = `var(--color-${nextBg})`;

const cards = Array.isArray(items) ? items : [];
const needsSpacer = cards.length % 3 === 2;
---

<section id={id} class={`section ${bgClass}`}>
  {angleTop && <AngleEdge position="top" direction={dirTop} height={100} />}
<!-- 
[&>*:last-child:nth-child(3n+1)]:lg:col-start-2  
[&>*:last-child:nth-child(3n+2)]:lg:col-start-3"> 
[&>*:nth-last-child(2):nth-child(3n+1)]:lg:col-start-2">

md:[grid-template-columns:repeat(auto-fit,minmax(280px,1fr))]
lg:[grid-template-columns:repeat(auto-fit,minmax(320px,1fr))]

<div class="card-grid grid gap-6 sm:gap-8 md:grid-cols-2 lg:grid-cols-3 items-stretch
-->
  <div class="card-shell px-6 py-16">
    <h2 class="text-2xl md:text-3xl font-bold mb-8">{title}</h2>
    <div class="card-grid grid gap-6 sm:gap-8 md:grid-cols-2 lg:grid-cols-3 items-stretch
    [&>*:last-child:nth-child(3n+1)]:lg:col-start-2">
      {items.map((it) => (
        <article class="card-vitae overflow-hidden rounded-lg border border-line bg-white shadow-sm flex flex-col h-full">
          {it.image && (
            <div class="relative w-full aspect-[16/9] rounded-t-lg overflow-hidden card-image">
              <img src={it.image} alt="" loading="lazy" class="absolute inset-0 block h-full w-full object-cover"/>
            </div>
          )}
            
          <div class="body flex-1 p-5 flex flex-col">
            <h3>{it.title}</h3>
            {it.body && <p>{it.body}</p>}
            {it.href && (
              <a href={it.href ?? "#"} class="cta mt-auto mx-auto inline-flex items-center justify-center gap-2 rounded-md border border-line px-5 py-2 text-sm hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-primary/30 w-fit">Learn more</a>
            )}
          </div>
        </article>
      ))}
    {needsSpacer && (
      <div
        aria-hidden="true"
        class="hidden lg:flex items-center justify-center rounded-2xl border-2 border-dashed border-[var(--color-primary)]/40 text-[var(--color-primary)]/60 text-2xl font-medium"
      >
        <span>H&C</span> {/* nbsp; Ã˜ */}
      </div>

      // Shaded empty card:
      // <div
      //   aria-hidden="true"
      //   class="hidden lg:block rounded-2xl bg-[var(--color-alt)] opacity-40"
      // />
    )}
    </div>
  </div>
  {angleBottom && <AngleEdge position="bottom" direction={dirBottom} fill={nextColor} height={100} />}
</section>
